<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>权限控制 | 学习笔记</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/docs/favicon.ico">
    <link rel="manifest" href="/docs/manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <meta name="description" content="前端工程师 Alex 的学习笔记">
    <meta name="author" content="Alex Wang">
    <meta name="keywords" content="vuepress , 前端, 学习笔记">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/docs/assets/css/0.styles.d2cb8686.css" as="style"><link rel="preload" href="/docs/assets/js/app.84b26931.js" as="script"><link rel="preload" href="/docs/assets/js/2.ce1bac44.js" as="script"><link rel="preload" href="/docs/assets/js/34.8c2c84ea.js" as="script"><link rel="preload" href="/docs/assets/js/7.f3e6aa45.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.9e342d30.js"><link rel="prefetch" href="/docs/assets/js/11.f40a53da.js"><link rel="prefetch" href="/docs/assets/js/12.16498b95.js"><link rel="prefetch" href="/docs/assets/js/13.b3f6806f.js"><link rel="prefetch" href="/docs/assets/js/14.cdfce6cd.js"><link rel="prefetch" href="/docs/assets/js/15.56907925.js"><link rel="prefetch" href="/docs/assets/js/16.4ddad054.js"><link rel="prefetch" href="/docs/assets/js/17.3540b6fb.js"><link rel="prefetch" href="/docs/assets/js/18.79300792.js"><link rel="prefetch" href="/docs/assets/js/19.03ad5bb0.js"><link rel="prefetch" href="/docs/assets/js/20.ded21212.js"><link rel="prefetch" href="/docs/assets/js/21.e657d943.js"><link rel="prefetch" href="/docs/assets/js/22.a7839767.js"><link rel="prefetch" href="/docs/assets/js/23.a8f18f0b.js"><link rel="prefetch" href="/docs/assets/js/24.c9254768.js"><link rel="prefetch" href="/docs/assets/js/25.d08eb9b8.js"><link rel="prefetch" href="/docs/assets/js/26.16666ea5.js"><link rel="prefetch" href="/docs/assets/js/27.5acfebc6.js"><link rel="prefetch" href="/docs/assets/js/28.ebe9596b.js"><link rel="prefetch" href="/docs/assets/js/29.47fa60b8.js"><link rel="prefetch" href="/docs/assets/js/3.de591152.js"><link rel="prefetch" href="/docs/assets/js/30.3d29431d.js"><link rel="prefetch" href="/docs/assets/js/31.1eabdbb0.js"><link rel="prefetch" href="/docs/assets/js/32.9005245e.js"><link rel="prefetch" href="/docs/assets/js/33.b62a5685.js"><link rel="prefetch" href="/docs/assets/js/35.9336b5cb.js"><link rel="prefetch" href="/docs/assets/js/36.97a3cc76.js"><link rel="prefetch" href="/docs/assets/js/37.66398741.js"><link rel="prefetch" href="/docs/assets/js/38.9d8de1d8.js"><link rel="prefetch" href="/docs/assets/js/39.8f67c036.js"><link rel="prefetch" href="/docs/assets/js/4.f5f9c22c.js"><link rel="prefetch" href="/docs/assets/js/40.e98a9424.js"><link rel="prefetch" href="/docs/assets/js/41.226b689f.js"><link rel="prefetch" href="/docs/assets/js/42.6d8e3c92.js"><link rel="prefetch" href="/docs/assets/js/43.b09bfbcd.js"><link rel="prefetch" href="/docs/assets/js/44.110861cb.js"><link rel="prefetch" href="/docs/assets/js/45.1361df68.js"><link rel="prefetch" href="/docs/assets/js/46.0825a84a.js"><link rel="prefetch" href="/docs/assets/js/47.7eed1a37.js"><link rel="prefetch" href="/docs/assets/js/48.314fd5a1.js"><link rel="prefetch" href="/docs/assets/js/49.09c0dc2c.js"><link rel="prefetch" href="/docs/assets/js/5.bc5eb3ee.js"><link rel="prefetch" href="/docs/assets/js/50.14490fbe.js"><link rel="prefetch" href="/docs/assets/js/51.10b8fc7a.js"><link rel="prefetch" href="/docs/assets/js/52.a3add2d1.js"><link rel="prefetch" href="/docs/assets/js/53.c4ce192c.js"><link rel="prefetch" href="/docs/assets/js/54.5cd22bdd.js"><link rel="prefetch" href="/docs/assets/js/55.9fe70fbb.js"><link rel="prefetch" href="/docs/assets/js/56.829f69ec.js"><link rel="prefetch" href="/docs/assets/js/57.97f358a1.js"><link rel="prefetch" href="/docs/assets/js/58.11cbfa72.js"><link rel="prefetch" href="/docs/assets/js/59.8200c4ed.js"><link rel="prefetch" href="/docs/assets/js/6.232177ed.js"><link rel="prefetch" href="/docs/assets/js/60.db894496.js"><link rel="prefetch" href="/docs/assets/js/61.d80fbdff.js"><link rel="prefetch" href="/docs/assets/js/62.2a66782f.js"><link rel="prefetch" href="/docs/assets/js/8.78886e18.js"><link rel="prefetch" href="/docs/assets/js/9.de6828aa.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.d2cb8686.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="backend" class="dropdown-title"><span class="title">backend</span> <span class="arrow down"></span></button> <button type="button" aria-label="backend" class="mobile-dropdown-title"><span class="title">backend</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/backend/NodeJs/" class="nav-link">
  Node Js
</a></li><li class="dropdown-item"><!----> <a href="/docs/backend/服务端渲染/" class="nav-link">
  服务端渲染
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="frontend" class="dropdown-title"><span class="title">frontend</span> <span class="arrow down"></span></button> <button type="button" aria-label="frontend" class="mobile-dropdown-title"><span class="title">frontend</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/frontend/ES6/" class="nav-link">
  E S 6
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/HTML&amp;CSS/" class="nav-link">
  HTML&amp;CSS
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/HTML5&amp;CSS3/" class="nav-link">
  HTML5&amp;CSS3
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/JavaScript/" class="nav-link">
  Java Script
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/minPrograms/" class="nav-link">
  Min Programs
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/Network/" class="nav-link">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/ng1/" class="nav-link">
  Ng1
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/TypeScript/" class="nav-link">
  Type Script
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/VUE/" class="nav-link router-link-active">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/webpack/" class="nav-link">
  Webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="interview" class="dropdown-title"><span class="title">interview</span> <span class="arrow down"></span></button> <button type="button" aria-label="interview" class="mobile-dropdown-title"><span class="title">interview</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/interview/base/" class="nav-link">
  Base
</a></li><li class="dropdown-item"><!----> <a href="/docs/interview/projects/" class="nav-link">
  Projects
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="reading" class="dropdown-title"><span class="title">reading</span> <span class="arrow down"></span></button> <button type="button" aria-label="reading" class="mobile-dropdown-title"><span class="title">reading</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/reading/" class="nav-link">
  Reading
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="tools" class="dropdown-title"><span class="title">tools</span> <span class="arrow down"></span></button> <button type="button" aria-label="tools" class="mobile-dropdown-title"><span class="title">tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/tools/axios/" class="nav-link">
  Axios
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/cli/" class="nav-link">
  Cli
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/devtools/" class="nav-link">
  Devtools
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/GIT/" class="nav-link">
  GIT
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/vscode/" class="nav-link">
  Vscode
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/vuepress/" class="nav-link">
  Vuepress
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/包管理工具/" class="nav-link">
  包管理工具
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/小工具/" class="nav-link">
  小工具
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/web-wj/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="backend" class="dropdown-title"><span class="title">backend</span> <span class="arrow down"></span></button> <button type="button" aria-label="backend" class="mobile-dropdown-title"><span class="title">backend</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/backend/NodeJs/" class="nav-link">
  Node Js
</a></li><li class="dropdown-item"><!----> <a href="/docs/backend/服务端渲染/" class="nav-link">
  服务端渲染
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="frontend" class="dropdown-title"><span class="title">frontend</span> <span class="arrow down"></span></button> <button type="button" aria-label="frontend" class="mobile-dropdown-title"><span class="title">frontend</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/frontend/ES6/" class="nav-link">
  E S 6
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/HTML&amp;CSS/" class="nav-link">
  HTML&amp;CSS
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/HTML5&amp;CSS3/" class="nav-link">
  HTML5&amp;CSS3
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/JavaScript/" class="nav-link">
  Java Script
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/minPrograms/" class="nav-link">
  Min Programs
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/Network/" class="nav-link">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/ng1/" class="nav-link">
  Ng1
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/TypeScript/" class="nav-link">
  Type Script
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/VUE/" class="nav-link router-link-active">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/webpack/" class="nav-link">
  Webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="interview" class="dropdown-title"><span class="title">interview</span> <span class="arrow down"></span></button> <button type="button" aria-label="interview" class="mobile-dropdown-title"><span class="title">interview</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/interview/base/" class="nav-link">
  Base
</a></li><li class="dropdown-item"><!----> <a href="/docs/interview/projects/" class="nav-link">
  Projects
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="reading" class="dropdown-title"><span class="title">reading</span> <span class="arrow down"></span></button> <button type="button" aria-label="reading" class="mobile-dropdown-title"><span class="title">reading</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/reading/" class="nav-link">
  Reading
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="tools" class="dropdown-title"><span class="title">tools</span> <span class="arrow down"></span></button> <button type="button" aria-label="tools" class="mobile-dropdown-title"><span class="title">tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/tools/axios/" class="nav-link">
  Axios
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/cli/" class="nav-link">
  Cli
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/devtools/" class="nav-link">
  Devtools
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/GIT/" class="nav-link">
  GIT
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/vscode/" class="nav-link">
  Vscode
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/vuepress/" class="nav-link">
  Vuepress
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/包管理工具/" class="nav-link">
  包管理工具
</a></li><li class="dropdown-item"><!----> <a href="/docs/tools/小工具/" class="nav-link">
  小工具
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/web-wj/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>VUE</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/frontend/VUE/" aria-current="page" class="sidebar-link">vue</a></li><li><a href="/docs/frontend/VUE/vue2.html" class="sidebar-link">vue2</a></li><li><a href="/docs/frontend/VUE/权限控制.html" class="active sidebar-link">权限控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/frontend/VUE/权限控制.html#权限的相关概念" class="sidebar-link">权限的相关概念</a></li><li class="sidebar-sub-header"><a href="/docs/frontend/VUE/权限控制.html#前端权限控制思路" class="sidebar-link">前端权限控制思路</a></li><li class="sidebar-sub-header"><a href="/docs/frontend/VUE/权限控制.html#前端权限实现的思路" class="sidebar-link">前端权限实现的思路</a></li><li class="sidebar-sub-header"><a href="/docs/frontend/VUE/权限控制.html#小结" class="sidebar-link">小结</a></li></ul></li><li><a href="/docs/frontend/VUE/vue3.html" class="sidebar-link">vue3</a></li><li><a href="/docs/frontend/VUE/vuex.html" class="sidebar-link">vuex 遇到的问题</a></li><li><a href="/docs/frontend/VUE/ES6 module.html" class="sidebar-link">ES6 module</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="权限控制"><a href="#权限控制" class="header-anchor">#</a> 权限控制</h1> <ul><li>在 Web 系统中，权限很久以来一直都只是后端程序所控制的。和数据库最紧密接触的是后端程序。所以在很长的一段时间内，权限一直都只是后端程序要考虑的话题。但是随看前后端分离架构的流行，越来越多的项目也在前端进权限控制。</li></ul> <h2 id="权限的相关概念"><a href="#权限的相关概念" class="header-anchor">#</a> 权限的相关概念</h2> <h3 id="权限的分类"><a href="#权限的分类" class="header-anchor">#</a> 权限的分类</h3> <ul><li>后端权限
<ul><li>从根本上讲前端仅仅只是视图层的展示，权限的核心是在于服务器中的数据，所以后端才是权限的关键，后端权限可以控制某个用户是否能够查询数据， 是否能够修改数据等操作。</li></ul> <ol><li>后端如何知道该请求是哪个用户发过来的？
<ul><li>状态管理 cookie、session、token</li></ul></li> <li>后端的权限设计 RBAC (Role-based Access Control)
<ul><li>用户、角色、权限</li></ul></li></ol></li> <li>前端权限
<ul><li>前端权限的控制本质上来说，就是控制端的视图层的展示和前端所发送的请求。但是只有前端权限控制没有后端权限控制是万万不可的。前端权限控制只可以说是达到锦上添花的效果。</li></ul></li></ul> <h3 id="前端权限的意义"><a href="#前端权限的意义" class="header-anchor">#</a> 前端权限的意义</h3> <ul><li>如果仅从能够修改服务器中数据库中的数据层面上讲， 确实只在后端做控制就足够了，那为什么越来越多的项目也进行了前端权限的控制，主要有这几方面的好处：
<ol><li>降低非法操作的可能性</li> <li>尽可能排除不必要清求， 减轻服务器压力</li> <li>提高用户体验
<ul><li>根据用户具备的权限为该用户展现自己权限范围内的内容， 避免在界面上给用户带来困扰， 让用户专注于分内之事。</li></ul></li></ol></li></ul> <h2 id="前端权限控制思路"><a href="#前端权限控制思路" class="header-anchor">#</a> 前端权限控制思路</h2> <h3 id="菜单的控制"><a href="#菜单的控制" class="header-anchor">#</a> 菜单的控制</h3> <ul><li>在登录请求中，会得到权限数据，当然，这个需要后端返回数据的支持．前端根据权限数据，展示对应的菜单,点击菜单，才能查看相关的界面</li></ul> <h3 id="界面的控制"><a href="#界面的控制" class="header-anchor">#</a> 界面的控制</h3> <ul><li>如果用户没有登录， 动在地址栏敲入管理界面的地址，则需要跳转到登录界面。</li> <li>如果用户已经登录，如果手动敲入非权限内的地址，则需要跳转 404 界面。</li></ul> <h3 id="按钮的控制"><a href="#按钮的控制" class="header-anchor">#</a> 按钮的控制</h3> <ul><li>在某个菜单的界面中，还得根据权限数据，展示出可进行操作的按钮，比如删除， 修改， 增加。</li></ul> <h3 id="请求和响应的控制"><a href="#请求和响应的控制" class="header-anchor">#</a> 请求和响应的控制</h3> <ul><li>如果用户通过非常规操作，比如通过浏览器调试工具将某些禁用的按钮变成启用状态，此时发的请求， 也应该被前端所拦截。</li></ul> <h2 id="前端权限实现的思路"><a href="#前端权限实现的思路" class="header-anchor">#</a> 前端权限实现的思路</h2> <h3 id="权限菜单栏控制"><a href="#权限菜单栏控制" class="header-anchor">#</a> 权限菜单栏控制</h3> <ul><li>用户登录之后服务端返回一个数据，这个数据有菜单列表和 token，我们把这个数据放入到 vuex 中，然后主页根据 vuex 中的数据进行菜单列表的渲染。
<ul><li>问题： 刷新界面 vuex 数据消失，菜单栏消失，怎么办？</li> <li>解决： 将数据存储在 sessionStorage 中，并让其和 vuex 中的数据保持同步。</li> <li>可使用插件 <a href="https://github.com/robinvdvleuten/vuex-persistedstate#readme" target="_blank" rel="noopener noreferrer">vuex-persistedstate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul> <h3 id="界面的控制-2"><a href="#界面的控制-2" class="header-anchor">#</a> 界面的控制</h3> <ul><li>登录成功后，将 token 数据存储在 sessionStorage 中，判断是否登录。</li></ul> <ol><li><p>路由导航守卫</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">beforEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/login'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>问题： 这样用户在登录之后就可以访问其他界面了，但如果用户 A 登录之后他只能访问 a 页面，他不能访问 b 页面，但是这时候他还是可以通过地址栏输入进入到 b 页面。</li> <li>解决： 当然我们也可以设置路由导航守卫，但是如果有多个页面，设置会非常不方便，并且对于用户 A 来说，它是不用访问 b 页面的，这时候我们何不对 A 不显示 b 页面，这个时候我们就用到了动态路由。</li></ul></li> <li><p>动态路由</p></li></ol> <ul><li><p>根据当前用户所拥有的的权限数据来动态添加所需要的路由，将这个封装成一个方法。</p></li> <li><p>登录成功之后动态添加路由，注意这个封装的方法需要暴露出去在登录页面调用。</p> <ul><li>问题： 如果我们重新刷新的话动态路由就会消失，动态路由是在登录成功之后才会调用的，刷新的时候并没有调用，所以动态路由没有添加上。</li> <li>解决： 可以在 app.vue 中的 created 中调用添加动态路由的方法。</li></ul></li></ul> <ol start="3"><li>按钮的控制</li></ol> <ul><li><p>虽然用户可以看到某些界面了，但是这个界面的一些按钮该用户可能是没有权限的。 因此，我们需要对组件中的一些按钮进行控制，将用户不具备权限的按钮就隐藏或者禁用，而在这块的实现中，可以把该逻辑放到自定义指令中。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">v-permission</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{action: <span class="token punctuation">'</span>add<span class="token punctuation">'</span>, effect: <span class="token punctuation">'</span>disabled<span class="token punctuation">'</span>}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>添加用户<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'@/router.js'</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'permission'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
<span class="token comment">// 被绑定元素插入父节点时调用 (仅保证父节点存在，但不一定已被插入文档中)</span>
<span class="token function">inserted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对应自定义指令中的 add</span>
    <span class="token keyword">const</span> action <span class="token operator">=</span> binding<span class="token punctuation">.</span>value<span class="token punctuation">.</span>action<span class="token punctuation">;</span>
    <span class="token comment">// 你可以将权限数据存到当前路由的元信息中</span>
    <span class="token keyword">const</span> currentRight <span class="token operator">=</span> router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>meta<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentRight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentRight<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不具备权限</span>
        <span class="token keyword">const</span> type <span class="token operator">=</span> binding<span class="token punctuation">.</span>value<span class="token punctuation">.</span>effect<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'disabled'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 禁用该节点</span>
            el<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 移除该节点</span>
            el<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></li></ul> <ol start="4"><li>请求和相应的控制</li></ol> <ul><li>请求控制
<ul><li>除了登录请求都得要带上 token ，这样服务器才可以鉴别你的身份,这块使用的就是 axios 的请求拦截器设置。</li> <li>如果发出了非权限内的请求，应该直接在前端范围内阻止，虽然这个请求发到服务器也会被拒绝。</li> <li>非权限内的请求：比如 a 用户是不能够操作该页面的按钮的，但是他通过 f12 调试把按钮改为可点击，如果我们不对这个请求进行处理，那么这个请求就会发送出去。</li></ul></li> <li>响应控制
<ul><li>得到了服务器返回的状态码 401, 代表 token 超时或者被篡改了，此时应该强制跳转到登录界面。</li></ul></li></ul> <h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <ul><li>前端权限的实现之须要后端提供数据支持， 否则无法实现。</li> <li>返回的权限数据的结构，前后端需要沟通协商怎样的数据便用起来才最方便</li></ul> <h3 id="菜单控制"><a href="#菜单控制" class="header-anchor">#</a> 菜单控制</h3> <ul><li>权限的数据需要在多组件之间共享， 因此采用 vuex</li> <li>防止刷新界面，权限数据丢失，所以需要存在 sessionStorage，并目要保证两者的同步。</li></ul> <h3 id="界面控制"><a href="#界面控制" class="header-anchor">#</a> 界面控制</h3> <ul><li>路由的导航守卫可以防止跳过登录界面。</li> <li>动态路由可以让不具备权限的界面的路由规则压根就不存在。</li></ul> <h3 id="按钮控制"><a href="#按钮控制" class="header-anchor">#</a> 按钮控制</h3> <ul><li>路由规则中可以增加路由元数据 meta</li> <li>通过路由对象可以得到当前的路由规则以及存在此规则中的 meta 数据</li> <li>自定义指令可以很方便的实现按钮控制</li></ul> <h3 id="请求和响应控制"><a href="#请求和响应控制" class="header-anchor">#</a> 请求和响应控制</h3> <ul><li>请求拦截器和响应拦截器的使用</li> <li>请求方式的约定restful</li></ul> <hr>
版权声明：本文为CSDN博主「胡歌的小奶音」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/weixin_44157964/article/details/108420759
</div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/frontend/VUE/vue2.html" class="prev">
        vue2
      </a></span> <span class="next"><a href="/docs/frontend/VUE/vue3.html">
        vue3
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/docs/assets/js/app.84b26931.js" defer></script><script src="/docs/assets/js/2.ce1bac44.js" defer></script><script src="/docs/assets/js/34.8c2c84ea.js" defer></script><script src="/docs/assets/js/7.f3e6aa45.js" defer></script>
  </body>
</html>
